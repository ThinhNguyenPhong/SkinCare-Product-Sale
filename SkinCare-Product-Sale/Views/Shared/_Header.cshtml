@{
    var username = Context.Session.GetString("Username");
    var role = Context.Session.GetString("Role");
}

<div class="header scrolling" id="myHeader">
    <div class="grid wide">
        <div class="header__top">
            <div class="navbar-icon">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <a href="/" class="header__logo">
                <img src="~/Layout/assets/logo.png" alt="">
            </a>
            <div class="header__search">
                <div class="header__search-wrap">
                    <input type="text" class="header__search-input" placeholder="Tìm kiếm">
                    <a class="header__search-icon" href="#">
                        <i class="fas fa-search"></i>
                    </a>
                </div>
            </div>
            <div class="header__account">
                @if (username != null)
                {
                    <ul class="header__nav-list" style="margin-bottom: 0 !important">
                        <li class="header__nav-item" style="color:#000000">
                            <a href="#" class="header__nav-link" style="line-height: 2;text-shadow: -1px -1px 0 black, 2px 0px 0 black, 0px 2px 0 black, 2px 2px 0 black;">Welcome, @username</a>
                            <div class="sub-nav-wrap grid wide">
                                <ul class="sub-nav">
                                    @if (role == "Customer")
                                    {
                                        <li class="sub-nav__item">
                                            <a href="/OrderHistory" class="sub-nav__link">Lịch sử mua hàng</a>
                                        </li>
                                        <li class="sub-nav__item">
                                            <a href="/Profile" class="sub-nav__link">Hồ sơ cá nhân</a>
                                        </li>
                                    }
                                    else if (role == "Staff")
                                    {
                                        <li class="sub-nav__item">
                                            <a href="/News" class="sub-nav__link">Quản lý tin tức</a>
                                        </li>
                                        <li class="sub-nav__item">
                                            <a href="/CustomerManagement" class="sub-nav__link">Quản lý đơn hàng</a>
                                        </li>
                                        <li class="sub-nav__item">
                                            <a href="/Product" class="sub-nav__link">Quản lý sản phẩm</a>
                                        </li>
                                    }
                                    else if (role == "Manager")
                                    {
                                        <li class="sub-nav__item">
                                            <a href="/Product" class="sub-nav__link">Quản lý sản phẩm</a>
                                        </li>
                                        <li class="sub-nav__item">
                                            <a href="/CustomerManagement" class="sub-nav__link">Quản lý khách hàng</a>
                                        </li>
                                        <li class="sub-nav__item">
                                            <a href="/StaffManagement" class="sub-nav__link">Quản lý nhân viên</a>
                                        </li>
                                    }

                                    <li class="sub-nav__item">
                                        <a href="#" onclick="logout()" class="sub-nav__link">Đăng Xuất</a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                }
                else
                {
                    <a href="#my-Login" class="header__account-login">Đăng Nhập</a>
                    <a href="#my-Register" class="header__account-register">Đăng Kí</a>
                }
            </div>


            <!-- Cart -->
            <div class="header__cart have" onclick="window.location = '/Cart'">
                <i class="fas fa-shopping-basket"></i>
                <div class="header__cart-amount">
                    <!-- Insert total quantity product in cart -->
                </div>
            </div>
        </div>
    </div>
    <!-- Menu -->
    <div class="header__nav">
        <ul class="header__nav-list">
            <li class="header__nav-item nav__search">
                <div class="nav__search-wrap">
                    <input class="nav__search-input" type="text" name="" id="" placeholder="Tìm sản phẩm...">
                </div>
                <div class="nav__search-btn">
                    <i class="fas fa-search"></i>
                </div>
            </li>
            <li class="header__nav-item authen-form">
                <a href="#" class="header__nav-link">Tài Khoản</a>
                <ul class="sub-nav">
                    <li class="sub-nav__item">
                        <a href="#my-Login" class="sub-nav__link">Đăng Nhập</a>
                    </li>
                    <li class="sub-nav__item">
                        <a href="#my-Register" class="sub-nav__link">Đăng Kí</a>
                    </li>
                </ul>
            </li>
            <li class="header__nav-item index">
                <a href="/" class="header__nav-link">Trang chủ</a>
            </li>

            <li class="header__nav-item">
                <a asp-controller="ListProduct" asp-action="index" class="header__nav-link">Sản Phẩm</a>
                <div class="sub-nav-wrap grid wide">
                    <ul class="sub-nav">
                        <li class="sub-nav__item">
                            <a href="" class="sub-nav__link heading">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                        </li>
                    </ul>
                    <ul class="sub-nav">
                        <li class="sub-nav__item">
                            <a href="" class="sub-nav__link heading">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                        </li>
                    </ul>
                    <ul class="sub-nav">
                        <li class="sub-nav__item">
                            <a href="" class="sub-nav__link heading">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                        </li>
                    </ul>
                    <ul class="sub-nav">
                        <li class="sub-nav__item">
                            <a href="" class="sub-nav__link heading">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                        </li>
                    </ul>
                </div>
            </li>
            <li class="header__nav-item">
                <a asp-controller="News" asp-action="Index" class="header__nav-link">Tin Tức</a>
            </li>
            <li class="header__nav-item">
                <a asp-controller="Contact" asp-action="Index" class="header__nav-link">Liên Hệ</a>
            </li>
        </ul>
    </div>
</div>

<script>
    async function logout() {
        try {
            const response = await fetch('/api/auth/logout', {
                method: 'get',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include'
            });

            if (response.ok) {
                window.location.href = '/';
            } else {
                console.error('Logout failed:', await response.text());
            }
        } catch (error) {
            console.error('Error logging out:', error);
        }
    }
</script>