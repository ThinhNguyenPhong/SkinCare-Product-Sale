@{
    var username = Context.Session.GetString("Username");
    var role = Context.Session.GetString("Role");
}
<!DOCTYPE html>
<html lang="en">
<!-- https://cocoshop.vn/ -->
<!-- http://mauweb.monamedia.net/vanihome/ -->

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkinCareProductSales</title>
    <!-- Font roboto -->
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <!-- Icon fontanwesome -->
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css" integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p" crossorigin="anonymous" />
    <!-- Reset css & grid sytem -->
    <link rel="stylesheet" href="~/Layout/assets/css/library.css">
    <link href="~/Layout/assets/owlCarousel/assets/owl.carousel.min.css" rel="stylesheet" />
    <!-- Layout -->
    <link rel="stylesheet" href="~/Layout/assets/css/common.css">
    <!-- index -->
    <link href="~/Layout/assets/css/home.css" rel="stylesheet" />

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Owl caroucel Js-->
    <script src="~/Layout/assets/owlCarousel/owl.carousel.min.js"></script>
</head>

<body>
    <!-- Header-->
    <div class="header scrolling" id="myHeader">
        <div class="grid wide">
            <div class="header__top">
                <div class="navbar-icon">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <a asp-controller="Home" asp-action="index" class="header__logo">
                    <img src="~/Layout/assets/logo.png" alt="">
                </a>
                <div class="header__search">
                    <div class="header__search-wrap">
                        <input type="text" class="header__search-input" placeholder="Tìm kiếm">
                        <a class="header__search-icon" href="#">
                            <i class="fas fa-search"></i>
                        </a>
                    </div>
                </div>
                <div class="header__account">
                    @if (username != null)
                    {
                        <ul class="header__nav-list" style="margin-bottom: 0 !important">
                            <li class="header__nav-item" style="color:#000000">
                                <a href="#" class="header__nav-link" style="line-height: 2;text-shadow: -1px -1px 0 black, 2px 0px 0 black, 0px 2px 0 black, 2px 2px 0 black;">Welcome, @username</a>
                                <div class="sub-nav-wrap grid wide">
                                    <ul class="sub-nav">
                                        @if (role == "Customer")
                                        {
                                            <li class="sub-nav__item">
                                                <a href="/OrderHistory" class="sub-nav__link">Lịch sử mua hàng</a>
                                            </li>
                                            <li class="sub-nav__item">
                                                <a href="/Profile" class="sub-nav__link">Hồ sơ cá nhân</a>
                                            </li>
                                        }
                                        else if (role == "Staff")
                                        {
                                            <li class="sub-nav__item">
                                                <a href="/News" class="sub-nav__link">Quản lý tin tức</a>
                                            </li>
                                            <li class="sub-nav__item">
                                                <a href="/CustomerManagement" class="sub-nav__link">Quản lý đơn hàng</a>
                                            </li>
                                            <li class="sub-nav__item">
                                                <a href="/Product" class="sub-nav__link">Quản lý sản phẩm</a>
                                            </li>
                                        }
                                        else if (role == "Manager")
                                        {
                                            <li class="sub-nav__item">
                                                <a href="/Product" class="sub-nav__link">Quản lý sản phẩm</a>
                                            </li>
                                            <li class="sub-nav__item">
                                                <a href="/CustomerManagement" class="sub-nav__link">Quản lý khách hàng</a>
                                            </li>
                                            <li class="sub-nav__item">
                                                <a href="/StaffManagement" class="sub-nav__link">Quản lý nhân viên</a>
                                            </li>
                                        }

                                        <li class="sub-nav__item">
                                            <a href="#" onclick="logout()" class="sub-nav__link">Đăng Xuất</a>
                                        </li>
                                    </ul>
                                </div>
                            </li>
                        </ul>
                    }
                    else
                    {
                        <a href="#my-Login" class="header__account-login">Đăng Nhập</a>
                        <a href="#my-Register" class="header__account-register">Đăng Kí</a>
                    }
                </div>
                <!-- Cart -->
                <div class="header__cart have" href="#">
                    <a href="/Cart" class="header__cart-link">
                        <div class="header__cart have">
                            <i class="fas fa-shopping-basket"></i>
                        </div>
                    </a>
                </div>
            </div>
        </div>
        <!-- Menu -->
        <div class="header__nav">
            <ul class="header__nav-list">
                <li class="header__nav-item nav__search">
                    <div class="nav__search-wrap">
                        <input class="nav__search-input" type="text" name="" id="" placeholder="Tìm sản phẩm...">
                    </div>
                    <div class="nav__search-btn">
                        <i class="fas fa-search"></i>
                    </div>
                </li>
                <li class="header__nav-item authen-form">
                    <a href="#" class="header__nav-link">Tài Khoản</a>
                    <ul class="sub-nav">
                        <li class="sub-nav__item">
                            <a href="#my-Login" class="sub-nav__link">Đăng Nhập</a>
                        </li>
                        <li class="sub-nav__item">
                            <a href="#my-Register" class="sub-nav__link">Đăng Kí</a>
                        </li>
                    </ul>
                </li>
                <li class="header__nav-item index">
                    <a asp-controller="Home" asp-action="index" class="header__nav-link">Trang chủ</a>
                </li>

                <li class="header__nav-item">
                    <a asp-controller="ListProduct" asp-action="index" class="header__nav-link">Sản Phẩm</a>
                    <div class="sub-nav-wrap grid wide">
                        <ul class="sub-nav">
                            <li class="sub-nav__item">
                                <a href="" class="sub-nav__link heading">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                            </li>
                        </ul>
                        <ul class="sub-nav">
                            <li class="sub-nav__item">
                                <a href="" class="sub-nav__link heading">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                            </li>
                        </ul>
                        <ul class="sub-nav">
                            <li class="sub-nav__item">
                                <a href="" class="sub-nav__link heading">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                            </li>
                        </ul>
                        <ul class="sub-nav">
                            <li class="sub-nav__item">
                                <a href="" class="sub-nav__link heading">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc toàn thân vvv</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Khuyến mãi</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc cơ thể</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Nước hoa</a>
                            </li>
                            <li class="sub-nav__item">
                                <a href="listProduct.html" class="sub-nav__link">Chăm sóc miệng</a>
                            </li>
                        </ul>
                    </div>
                </li>
                <li class="header__nav-item">
                    <a asp-controller="News" asp-action="Index" class="header__nav-link">Tin Tức</a>
                </li>
                <li class="header__nav-item">
                    <a asp-controller="Contact" asp-action="Index" class="header__nav-link">Liên Hệ</a>
                </li>
            </ul>
        </div>
    </div>

    @RenderBody()
    <!-- Footer-->
    <div class="footer">
        <div class="grid wide">
            <div class="row">
                <div class="col l-3 m-6 s-12">
                    <h3 class="footer__title">Menu</h3>
                    <ul class="footer__list">
                        <li class="footer__item">
                            <a href="#" class="footer__link">Trang điểm</a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">Chăm sóc da</a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">Chăm sóc tóc</a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">Nước hoa</a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">Chăm sóc toàn thân </a>
                        </li>
                    </ul>
                </div>
                <div class="col l-3 m-6 s-12">
                    <h3 class="footer__title">Hỗ trợ khách hàng</h3>
                    <ul class="footer__list">
                        <li class="footer__item">
                            <a href="#" class="footer__link">Hướng dẫn mua hàng</a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">Giải đáp thắc mắc</a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">Chính sách mua hàng</a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">Chính sách đổi trả</a>
                        </li>
                    </ul>
                </div>
                <div class="col l-3 m-6 s-12">
                    <h3 class="footer__title">Liên hệ</h3>
                    <ul class="footer__list">
                        <li class="footer__item">
                            <span class="footer__text">
                                <i class="fas fa-map-marked-alt"></i> Nhà Văn hóa Sinh viên TP.HCM, Lưu Hữu Phước Tân Lập, Đông Hòa, Dĩ An, Bình Dương
                            </span>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">
                                <i class="fas fa-phone"></i> 0372767497
                            </a>
                        </li>
                        <li class="footer__item">
                            <a href="#" class="footer__link">
                                <i class="fas fa-envelope"></i> phongthinh799@gmail.com
                            </a>
                        </li>
                        <li class="footer__item">
                            <div class="social-group">
                                <a href="#" class="social-item">
                                    <i class="fab fa-facebook-f"></i>
                                </a>
                                <a href="#" class="social-item">
                                    <i class="fab fa-twitter"></i>
                                </a>
                                <a href="#" class="social-item">
                                    <i class="fab fa-pinterest-p"></i>
                                </a>
                                <a href="#" class="social-item">
                                    <i class="fab fa-invision"></i>
                                </a>
                                <a href="#" class="social-item">
                                    <i class="fab fa-youtube"></i>
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="col l-3 m-6 s-12">
                    <h3 class="footer__title">Đăng kí</h3>
                    <ul class="footer__list">
                        <li class="footer__item">
                            <span class="footer__text">Đăng ký để nhận được được thông tin ưu đãi mới nhất từ chúng tôi.</span>
                        </li>
                        <li class="footer__item">
                            <div class="send-email">
                                <input class="send-email__input" type="email" placeholder="Nhập Email...">
                                <a href="#" class="send-email__link">
                                    <i class="fas fa-paper-plane"></i>
                                </a>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Form -->
    <div class="ModalForm">
        <!-- Modal Đăng Ký -->
        <div class="modal" id="my-Register">
            <a href="#" class="overlay-close"></a>
            <div class="authen-modal register">
                <h3 class="authen-modal__title">Đăng Kí</h3>

                <div class="form-group">
                    <label for="username" class="form-label">Tên Đăng Nhập *</label>
                    <input id="username" name="username" type="text" class="form-control" placeholder="Nhập tên đăng nhập" />
                    <span class="form-message"></span>
                </div>

                <div class="form-group">
                    <label for="fullName" class="form-label">Họ và Tên *</label>
                    <input id="fullName" name="fullName" type="text" class="form-control" placeholder="Nhập họ và tên" />
                    <span class="form-message"></span>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">Email *</label>
                    <input id="email" name="email" type="email" class="form-control" placeholder="Nhập email" />
                    <span class="form-message"></span>
                </div>

                <div class="form-group">
                    <label for="phone" class="form-label">Số Điện Thoại *</label>
                    <input id="phone" name="phone" type="tel" class="form-control" placeholder="Nhập số điện thoại" />
                    <span class="form-message"></span>
                </div>

                <div class="form-group">
                    <label for="password" class="form-label">Mật khẩu *</label>
                    <input id="password" name="password" type="password" class="form-control" placeholder="Nhập mật khẩu" />
                    <span class="form-message"></span>
                </div>

                <div class="form-group">
                    <label for="confirmPassword" class="form-label">Nhập lại mật khẩu *</label>
                    <input id="confirmPassword" name="confirmPassword" type="password" class="form-control" placeholder="Nhập lại mật khẩu" />
                    <span class="form-message"></span>
                </div>

                <div class="authen__btns">
                    <button class="btn btn--default" onclick="registerUser()">Đăng Kí</button>
                </div>

            </div>
        </div>

        <div class="modal" id="my-Login">
            <a href="#" class="overlay-close"></a>
            <div class="authen-modal login">
                <h3 class="authen-modal__title">Đăng Nhập</h3>
                <div class="form-group">
                    <label for="loginEmail" class="form-label">Tên đăng nhập *</label>
                    <input id="loginEmail" name="loginEmail" type="email" class="form-control" placeholder="Nhập tên đăng nhập" />
                    <span class="form-message"></span>
                </div>
                <div class="form-group">
                    <label for="loginPassword" class="form-label">Mật khẩu *</label>
                    <input id="loginPassword" name="loginPassword" type="password" class="form-control" placeholder="Nhập mật khẩu" />
                    <span class="form-message"></span>
                </div>
                <div class="authen__btns">
                    <button class="btn btn--default" onclick="loginUser()">Đăng Nhập</button>
                </div>
            </div>
        </div>

        <div class="up-top" id="upTop" onclick="goToTop()">
            <i class="fas fa-chevron-up"></i>
        </div>
    </div>
    <script>
        $('.owl-carousel.hight').owlCarousel({
            loop: true,
            margin: 20,
            nav: true,
            dots: false,
            autoplay: true,
            autoplayTimeout: 3000,
            autoplayHoverPause: true,
            responsive: {
                0: {
                    items: 2
                },
                600: {
                    items: 3
                },
                1000: {
                    items: 5
                }
            }
        })
        $('.owl-carousel.news').owlCarousel({
            loop: true,
            margin: 20,
            nav: true,
            dots: false,
            autoplay: true,
            autoplayTimeout: 4000,
            autoplayHoverPause: true,
            responsive: {
                0: {
                    items: 1
                },
                600: {
                    items: 1
                },
                1000: {
                    items: 2
                }
            }
        })
        $('.owl-carousel.bands').owlCarousel({
            loop: true,
            margin: 20,
            nav: false,
            dots: false,
            autoplay: true,
            autoplayTimeout: 2000,
            autoplayHoverPause: true,
            responsive: {
                0: {
                    items: 2
                },
                600: {
                    items: 3
                },
                1000: {
                    items: 6
                }
            }
        })
    </script>
    <!-- Script common -->
    <script src="~/Layout/assets/js/homeScript.js"></script>
    <script src="~/Layout/assets/js/commonscript.js"></script>
    <script>
        async function registerUser() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            const confirmPassword = document.getElementById("confirmPassword").value;
            const fullName = document.getElementById("fullName").value;
            const email = document.getElementById("email").value;
            const phone = document.getElementById("phone").value;

            if (!username || !password || !confirmPassword || !fullName || !email || !phone) {
                alert("Vui lòng nhập đầy đủ thông tin!");
                return;
            }

            if (password.length < 6) {
                alert("Mật khẩu phải có ít nhất 6 ký tự!");
                return;
            }

            if (password !== confirmPassword) {
                alert("Mật khẩu không khớp!");
                return;
            }

            try {
                const response = await fetch('/api/auth/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password, fullName, email, phone }),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.message || "Đăng ký thất bại");
                }

                const data = await response.json();
                alert(data.message);
                window.location.href = "/"; 
            } catch (error) {
                alert(error.message);
            }
        }





        async function loginUser() {
            try {

                const email = document.getElementById("loginEmail").value;
                const password = document.getElementById("loginPassword").value;

                // Gửi yêu cầu đăng nhập
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ "username": email, "password": password }),
                });

                // Kiểm tra mã trạng thái của phản hồi
                if (response.ok) {
                    // Nếu đăng nhập thành công (HTTP 200)
                    const data = await response.json();
                    console.log(data); // Xem thông báo thành công

                    // Chuyển hướng người dùng về trang chủ sau khi đăng nhập thành công
                    window.location = "/";
                } else {
                    // Nếu đăng nhập thất bại (HTTP 401)
                    const errorData = await response.text(); // Lấy thông báo lỗi
                    alert(errorData);
                }
            } catch (error) {
                console.error("Lỗi đăng nhập: ", error);
                alert("Đã có lỗi xảy ra, vui lòng thử lại sau.");
            }
        }
            async function logout() {
                try {
                    const response = await fetch('/api/auth/logout', {
                method: 'get',
            headers: {
                'Content-Type': 'application/json'
                        },
            credentials: 'include'
                    });

            if (response.ok) {
                window.location.href = '/';
                    } else {
                console.error('Logout failed:', await response.text());
                    }
                } catch (error) {
                console.error('Error logging out:', error);
                }
            }

    </script>
</body>
</html>